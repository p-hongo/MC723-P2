/******************************************************
 * Architecture Module header file.                   *
 * This file is automatically generated by ArchC      *
 * WITHOUT WARRANTY OF ANY KIND, either express       *
 * or implied.                                        *
 * For more information on ArchC, please visit:       *
 * http://www.archc.org                               *
 *                                                    *
 * The ArchC Team                                     *
 * Computer Systems Laboratory (LSC)                  *
 * IC-UNICAMP                                         *
 * http://www.lsc.ic.unicamp.br                       *
 ******************************************************/
 

#ifndef  _MIPS1_H
#define  _MIPS1_H

#include "systemc.h"
#include "ac_module.H"
#include "ac_utils.H"
#include "mips1_parms.H"
#include "mips1_arch.H"
#include "mips1_isa.H"
#include "mips1_syscall.H"
extern "C" {
#include "d4.h"
#include "cmdd4.h"
#include "cmdargs.h"
}


class mips1: public ac_module, public mips1_arch {
private:
  typedef cache_item<mips1_parms::AC_DEC_FIELD_NUMBER> cache_item_t;
  typedef ac_instr<mips1_parms::AC_DEC_FIELD_NUMBER> ac_instr_t;
public:

  unsigned bhv_pc;
 

  bool has_delayed_load;
  char* delayed_load_program;

  mips1_parms::mips1_isa ISA;
  cache_item_t* DEC_CACHE;

  unsigned id;

  bool start_up;
  unsigned* instr_dec;
  ac_instr_t* instr_vec;
  ac_instr_t* previous_instruction[2];

  //!Behavior execution method.
  void behavior();

  bool has_load_read_dependency(ac_instr_t *i1, ac_instr_t *i2);

  void detect_data_hazard();

  d4cache* set_mem_cache();

    void print_cache_status(d4cache *cache);

    void get_mem_cache_misses(int ac_annul_sig, int ins_id, mips1::ac_instr_t* instr_vec, d4cache *cache);

  SC_HAS_PROCESS( mips1 );

  //!Constructor.
  mips1( sc_module_name name_ ): ac_module(name_), mips1_arch(), ISA(*this) {

    SC_THREAD( behavior );
    bhv_pc = 0; 
    has_delayed_load = false; 
    start_up=1;
    id = 1;
    previous_instruction[0] = previous_instruction[1] = NULL;
  }
  void init_dec_cache() {
    DEC_CACHE = (cache_item_t*) calloc(sizeof(cache_item_t),dec_cache_size);
  }

  unsigned get_ac_pc();

  void set_ac_pc( unsigned int value );

  virtual void PrintStat();

  void init(int ac, char* av[]);

  void init();

  void load(char* program);

  void delayed_load(char* program);

  void stop(int status = 0);

  virtual ~mips1() {};

};
#endif  //_MIPS1_H

